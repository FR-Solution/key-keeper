---
issuers:

  - name: kube-apiserver-sa
    vault:
      server: http://example.com:9200
      auth:
        caBundle: 
        tlsInsecure: true
        bootstrap:
          token: ${token}
        appRole:
          name: kube-apiserver-sa
          path: "clusters/cluster-1/approle"
          secretIDLocalPath: /var/lib/key-keeper/vault/kube-apiserver-sa/secret-id
          roleIDLocalPath: /var/lib/key-keeper/vault/kube-apiserver-sa/role-id
      kv:
        path: clusters/cluster-1/kv
      timeout: 15s

  - name: kubernetes-ca
    vault:
      server: http://example.com:9200
      auth:
        caBundle: 
        tlsInsecure: true
        bootstrap:
          token: ${token}
        appRole:
          name: kubernetes-ca
          path: "clusters/cluster-1/approle"
          secretIDLocalPath: /var/lib/key-keeper/vault/kubernetes-ca/secret-id
          roleIDLocalPath: /var/lib/key-keeper/vault/kubernetes-ca/role-id
      certificate:
        CAPath: "clusters/cluster-1/pki/kubernetes"
        rootCAPath: "clusters/cluster-1/pki/root"
      timeout: 15s

  - name: kubelet-server
    vault:
      server: http://example.com:9200
      auth:
        caBundle: 
        tlsInsecure: true
        bootstrap:
          token: hvs.Ouy9gdxmkEnBmYCVJQsYj1vA
        appRole:
          name: kubelet-server-ru-central1-a
          path: "clusters/cluster-1/approle"
          secretIDLocalPath: /var/lib/key-keeper/vault/kubelet-server/secret-id
          roleIDLocalPath: /var/lib/key-keeper/vault/kubelet-server/role-id
      certificate:
        role: kubelet-server
        CAPath: "clusters/cluster-1/pki/kubernetes"
      timeout: 15s


certificates:


  - name: kubernetes-ca
    issuerRef:
      name: kubernetes-ca
    isCa: true
    ca:
      exportedKey: false
      generate: false
    hostPath: "/etc/kubernetes/pki/ca"

  - name: kubelet-server
    issuerRef:
      name: kubelet-server
    spec:
      subject:
        commonName: "system:node:default.cluster-1.dobry-kot.ru"
      usage:
        - server auth
      privateKey:
        algorithm: "RSA"
        encoding: "PKCS1"
        size: 4096
      ipAddresses:
        interfaces:
          - lo
          - eth*
      ttl: 200h
      hostnames:
        - localhost
        - "master-0.cluster-1.dobry-kot.ru"
    renewBefore: 100h
    hostPath: "/etc/kubernetes/pki/certs/kubelet"


secrets:

  - name: kube-apiserver-sa
    issuerRef:
      name: kube-apiserver-sa
    key: public  
    hostPath: /etc/kubernetes/pki/certs/kube-apiserver/kube-apiserver-sa.pub
